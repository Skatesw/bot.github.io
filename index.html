<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–î–Ω–µ–≤–Ω–∏–∫ –≠–º–æ—Ü–∏–π</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>üìÖ –ú–æ–π –¥–Ω–µ–≤–Ω–∏–∫</h1>

        <div class="mood-selector">
            <h3>–ö–∞–∫–æ–µ —É —Ç–µ–±—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ?</h3>
            <div class="moods">
                <button onclick="logMood('happy')">üòä –†–∞–¥–æ—Å—Ç—å</button>
                <button onclick="logMood('neutral')">üòê –ù–æ—Ä–º–∞–ª—å–Ω–æ</button>
                <button onclick="logMood('sad')">üò¢ –ì—Ä—É—Å—Ç—å</button>
            </div>
        </div>

        <div class="notes">
            <h3>–ó–∞–º–µ—Ç–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</h3>
            <textarea id="note" placeholder="–û–ø–∏—à–∏ —Å–≤–æ–∏ —á—É–≤—Å—Ç–≤–∞..."></textarea>
        </div>

        <div class="history">
            <h3>–ò—Å—Ç–æ—Ä–∏—è</h3>
            <div id="mood-history"></div>
        </div>
    </div>

    <script>
        const tg = Telegram.WebApp;
        tg.expand();
        tg.MainButton.setText("–°–æ—Ö—Ä–∞–Ω–∏—Ç—å").show().onClick(saveData);

        function logMood(mood) {
            tg.MainButton.show();
            currentMood = mood;
        }

        function saveData() {
            const note = document.getElementById('note').value;

            tg.sendData(JSON.stringify({
                user_id: tg.initDataUnsafe.user.id,
                mood: currentMood,
                note: note
            }));

            tg.close();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
        fetch(`/api/get_moods?user_id=${tg.initDataUnsafe.user.id}`)
            .then(res => res.json())
            .then(data => {
                const history = document.getElementById('mood-history');
                history.innerHTML = data.map(item => `
                    <div class="entry">
                        <span class="date">${new Date(item.date).toLocaleDateString()}</span>
                        <span class="mood ${item.mood}"></span>
                        <p>${item.note || ''}</p>
                    </div>
                `).join('');
            });
    </script>
</body>
</html>